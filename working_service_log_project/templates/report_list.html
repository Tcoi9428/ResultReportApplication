{% extends "base.html" %}

{% block title %}–ë–∞–∑–∞ –ê–í–†{% endblock %}

{% block content %}
  <div class="mt-4">
    <h2 class="mb-4">–°–ø–∏—Å–æ–∫ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –ê–í–†</h2>

    <!-- üîç –§–æ—Ä–º–∞ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ -->
    <form method="get" class="row g-3 mb-4">
      <div class="filtres-blocks">
      <div class="col-md-2 filter-block">
        <label for="date_from" class="form-label">–° –¥–∞—Ç—ã</label>
        <input type="date" name="date_from" id="date_from" class="form-control" value="{{ selected_filters.date_from }}">
      </div>
      <div class="col-md-2 filter-block">
        <label for="date_to" class="form-label">–ü–æ –¥–∞—Ç—É</label>
        <input type="date" name="date_to" id="date_to" class="form-control" value="{{ selected_filters.date_to }}">
      </div>
      <div class="col-md-2 filter-block">
        <label for="organization" class="form-label">–û—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è</label>
        <select name="organization" id="organization" class="form-select">
          <option value="">–í—Å–µ</option>
          {% for org in organizations %}
            <option value="{{ org.id }}" {% if org.id|stringformat:"s" == selected_filters.organization %}selected{% endif %}>{{ org.name }}</option>
          {% endfor %}
        </select>
      </div>
      <div class="col-md-2 filter-block">
        <label for="model" class="form-label">–ú–æ–¥–µ–ª—å</label>
        <select name="model" id="model" class="form-select">
          <option value="">–í—Å–µ</option>
          {% for m in models %}
            <option value="{{ m.id }}" {% if m.id|stringformat:"s" == selected_filters.model %}selected{% endif %}>{{ m.name }}</option>
          {% endfor %}
        </select>
      </div>
      <div class="col-md-2 filter-block">
        <label for="equipment" class="form-label">–û–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ</label>
        <select name="equipment" id="equipment" class="form-select">
          <option value="">–í—Å–µ</option>
          {% for e in equipments %}
            <option value="{{ e.id }}" {% if e.id|stringformat:"s" == selected_filters.equipment %}selected{% endif %}>
              –ì–∞—Ä.‚Ññ- {{ e.factory_number }} / –ó–∞–≤.‚Ññ- {{ e.garage_number }}
            </option>
          {% endfor %}
        </select>
      </div>
      <div class="col-md-2 filter-block">
        <label for="reglament" class="form-label">–í–∏–¥ –¢–û</label>
        <select name="reglament" id="reglament" class="form-select">
          <option value="">–í—Å–µ</option>
          {% for r in reglaments %}
            <option value="{{ r.id }}" {% if r.id|stringformat:"s" == selected_filters.reglament %}selected{% endif %}>{{ r.name }}</option>
          {% endfor %}
        </select>
      </div>
      </div>
      <div class="col-12 d-flex justify-content-end">
        <button type="submit" class="btn btn-primary me-2">–ü—Ä–∏–º–µ–Ω–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä</button>
        <a href="{% url 'report_list' %}" class="btn btn-secondary clear-btn">–°–±—Ä–æ—Å–∏—Ç—å</a>
      </div>
    </form>

    <!-- üìÑ –¢–∞–±–ª–∏—Ü–∞ –æ—Ç—á—ë—Ç–æ–≤ -->
    <table class="table table-striped table-bordered">
      <thead class="table-light">
        <tr>
          <th>–ü—Ä–µ–¥–ø—Ä–∏—è—Ç–∏–µ</th>          
          <th>–ù–æ–º–µ—Ä –ê–í–†</th>         
          <th>–î–∞—Ç–∞</th>
          <th>–í—Ä–µ–º—è –Ω–∞—á–∞–ª–∞</th>
          <th>–í—Ä–µ–º—è –æ–∫–æ–Ω—á–∞–Ω–∏—è</th>
          <th>–ú–æ–¥–µ–ª—å</th>
          <th>–ó–∞–≤. ‚Ññ</th>
          <th>–ì–∞—Ä. ‚Ññ</th>
          <th>–í–∏–¥ –¢–û</th>
          <th>–ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å —Ä–∞–±–æ—Ç</th>
          <th>–û–ø–∏—Å–∞–Ω–∏–µ —Ä–∞–±–æ—Ç</th>
          <th>PDF</th>
        </tr>
      </thead>
      <tbody>
        {% for r in reports %}
          <tr>
            <td>{{ r.service_organization }}</td>
            <td>{{ r.service_act_number }}</td>
            <td>{{ r.service_work_date|date:"d.m.Y"}}</td>
            <td>{{ r.service_time_start|date:"H:i"}}</td>
            <td>{{ r.service_time_end|date:"H:i"}}</td>            
            <td>{{ r.equip_model.name }}</td>
            <td>{{ r.equipment.factory_number }}</td>
            <td>{{ r.equipment.garage_number }}</td>
            <td>{{ r.service_reglament_work_type }}</td>            
            <td>
              {% for person in r.service_employer_fio.all %}
                {{ person.full_name }}{% if not forloop.last %}, {% endif %}
              {% endfor %}
            </td>
            <td>{{ r.service_work_description|truncatewords:10 }}</td>
            <td>
              {% if r.service_pdf_file %}
                <a href="{{ r.service_pdf_file.url }}" target="_blank" class="btn btn-sm btn-outline-primary">
                  üìÑ
                </a>
              {% else %}
                ‚Äî
              {% endif %}
            </td>
          </tr>
        {% empty %}
          <tr>
            <td colspan="7" class="text-center">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö.</td>
          </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
{% endblock %}